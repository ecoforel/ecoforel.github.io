... </script> <!-- здесь заканчивается твой большой GeoJSON -->

<script>
const $ = s=>document.querySelector(s);
const toastEl = $("#toast");
function toast(msg){ toastEl.textContent = msg; toastEl.classList.add("show"); setTimeout(()=>toastEl.classList.remove("show"), 2400); }

const GEOJSON = JSON.parse(document.getElementById('zones').textContent);
const zoneNames = {"8":"Санкт-Петербург","7":"Ломоносов, Пушкин, Всеволожск","6":"Кировск, Шлиссельбург","4":"Гатчина, Коммунар, Никольское","3":"Сиверский, Вырица","5":"Зеленогорск, Сестрорецк","0":"Приозерск, Сосново, Токсово","1":"Волхов","2":"Кириши"};

function swapLngLat(c){ if(Array.isArray(c) && typeof c[0]==='number') return [c[1],c[0]]; if(Array.isArray(c)) return c.map(swapLngLat); return c; }
function convertForYmaps(fc){
  const out = { type:"FeatureCollection", features:[] };
  (fc.features||[]).forEach((f,i)=>{
    if(!f || !f.geometry) return;
    const t = f.geometry.type;
    if(t!=="Polygon" && t!=="MultiPolygon") return;
    out.features.push({
      type:"Feature",
      id: (f.id ?? i),
      properties: f.properties || {},
      geometry: { type:t, coordinates: swapLngLat(f.geometry.coordinates) }
    });
  });
  return out;
}

let map, objectManager, userPlacemark=null;

ymaps.ready(()=>{
  map = new ymaps.Map('map', {center:[59.9386,30.3141], zoom:9, controls:['zoomControl','typeSelector','fullscreenControl']});
  objectManager = new ymaps.ObjectManager({clusterize:false, geoObjectOpenBalloonOnClick:true});
  map.geoObjects.add(objectManager);

  const ymData = convertForYmaps(GEOJSON);
  objectManager.add(ymData);

  // стили и балуны
  objectManager.objects.each((obj)=>{
    const id = obj.id;
    const name = zoneNames[id] || ('Зона '+id);
    objectManager.objects.setObjectProperties(id, {
      balloonContent: `<div style="font-weight:700">${name}</div>`,
      hintContent: name
    });
  });

  try { const b = objectManager.objects.getBounds(); if(b) map.setBounds(b, {checkZoomRange:true, zoomMargin:40}); } catch(e){}

  $("#check").addEventListener("click", checkAddress);
  $("#addr").addEventListener("keydown", e=>{ if(e.key==="Enter") checkAddress(); });
});

function pointInsideAnyZone(coords){
  let hit = null;
  objectManager.objects.each((obj)=>{
    if(hit) return;
    try{
      const geom = new ymaps.geometry[obj.geometry.type](obj.geometry.coordinates);
      if(geom.contains(coords)) hit = obj;
    }catch(e){}
  });
  return hit;
}

async function checkAddress(){
  const addr = $("#addr").value.trim();
  if(!addr) return toast("Введите адрес");

  const params = new URLSearchParams({
    format: "jsonv2", q: addr, limit: "1", countrycodes: "ru",
    "accept-language": "ru", viewbox: "28.0,60.5,31.5,59.5", bounded: "1"
  });

  try {
    const resp = await fetch("https://nominatim.openstreetmap.org/search?" + params, {headers: {"Accept":"application/json"}});
    if(!resp.ok) return toast("Ошибка геокодера (OSM)");
    const arr = await resp.json();
    if(!arr.length) return toast("Адрес не найден");

    const lat = parseFloat(arr[0].lat), lon = parseFloat(arr[0].lon);
    const coords = [lat, lon];

    if(!userPlacemark){
      userPlacemark = new ymaps.Placemark(coords, { balloonContent: addr }, { preset: 'islands#redDotIcon' });
      map.geoObjects.add(userPlacemark);
    } else {
      userPlacemark.geometry.setCoordinates(coords);
      userPlacemark.properties.set('balloonContent', addr);
    }
    map.panTo(coords);

    const hit = pointInsideAnyZone(coords);
    const box = $("#zoneResult");
    if(hit){
      const name = zoneNames[hit.id] || ('Зона '+hit.id);
      box.classList.remove('hidden');
      box.innerHTML = `<div class="zr-title">Адрес в зоне доставки: ${name}</div>`;
      userPlacemark.properties.set('balloonContent', `${addr}<br><b>${name}</b>`);
      userPlacemark.balloon.open();
      toast('Адрес в зоне доставки');
    } else {
      box.classList.remove('hidden');
      box.innerHTML = `<div class="zr-title">Адрес вне зон доставки</div>`;
      userPlacemark.properties.set('balloonContent','Адрес вне зон доставки.');
      userPlacemark.balloon.open();
      toast('Вне зоны доставки');
    }
  } catch(e){
    console.error(e);
    toast('Ошибка сети или OSM геокодера');
  }
}
</script>
</body>
</html>
